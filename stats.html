<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Join Game</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 20px; text-align: center; }
    video { width: 300px; border: 2px solid #444; margin-top: 10px; }
    #joinedMessage { color: limegreen; margin-top: 20px; }
  </style>
</head>
<body>

<h1>Join Game</h1>
<div id="joinArea">
  <input id="nameInput" placeholder="Enter Name" /><br>
  <video id="cam" autoplay muted></video><br>
  <button id="capture">Join</button>
</div>
<div id="joinedMessage" hidden>âœ… Joined! Wait for the game to begin...</div>

<script>
  const joinKey = 'joining_open';
  const video = document.getElementById('cam');
  const nameInput = document.getElementById('nameInput');
  const joinBtn = document.getElementById('capture');
  const joinedMsg = document.getElementById('joinedMessage');
  const joinArea = document.getElementById('joinArea');

  navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    video.srcObject = stream;
  });

  joinBtn.onclick = () => {
    const name = nameInput.value.trim();
    if (!name) return alert("Enter your name.");
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);
    const image = canvas.toDataURL();
    const players = JSON.parse(localStorage.getItem("joined_players") || "[]");
    if (players.find(p => p.name === name)) return alert("Name already taken!");
    players.push({ name, image });
    localStorage.setItem("joined_players", JSON.stringify(players));
    joinArea.hidden = true;
    joinedMsg.hidden = false;
  };

  setInterval(() => {
    const isOpen = localStorage.getItem(joinKey) === "true";
    joinArea.hidden = !isOpen;
    joinedMsg.hidden = isOpen;
  }, 500);
</script>
</body>
</html>

