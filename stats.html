<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Darts Stats</title>
<style>
body {
  background: #111;
  color: #eee;
  font-family: 'Arial', sans-serif;
  margin: 0; padding: 20px;
}
h1 {
  color: #ffcc00;
  text-align: center;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  background: #222;
}
th, td {
  padding: 10px;
  border: 1px solid #333;
  text-align: center;
}
th {
  background: #444;
  color: #ffcc00;
}
img.player-pic {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}
</style>
</head>
<body>

<h1>Darts Tournament Stats</h1>

<table id="statsTable">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Player</th>
      <th>Avg Score</th>
      <th>Games Played</th>
      <th>Wins</th>
      <th>Losses</th>
      <th>Win %</th>
      <th>Lose %</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let players = [];
let playerPics = {};
let stats = {}; // stats per player: {games: x, wins: y, losses: z, totalScore: n}

function loadStats() {
  players = JSON.parse(localStorage.getItem("dartsPlayers") || "[]");
  playerPics = JSON.parse(localStorage.getItem("dartsPlayerPics") || "{}");
  stats = JSON.parse(localStorage.getItem("dartsPlayerStats") || "{}");

  // Ensure stats for all players
  players.forEach(p => {
    if (!stats[p]) {
      stats[p] = { games: 0, wins: 0, losses: 0, totalScore: 0 };
    }
  });
}

function calculateAverages() {
  players.forEach(p => {
    const s = stats[p];
    s.avg = s.games > 0 ? (s.totalScore / s.games).toFixed(2) : "0.00";
    s.winPercent = s.games > 0 ? ((s.wins / s.games) * 100).toFixed(1) : "0.0";
    s.losePercent = s.games > 0 ? ((s.losses / s.games) * 100).toFixed(1) : "0.0";
  });
}

function renderStats() {
  const tbody = document.querySelector("#statsTable tbody");
  calculateAverages();

  // Sort by avg score descending
  const sorted = [...players].sort((a, b) => (stats[b].avg - stats[a].avg));

  tbody.innerHTML = sorted.map((p, idx) => {
    const s = stats[p];
    const pic = playerPics[p] || "assets/default_player.png";
    return `<tr>
      <td>${idx + 1}</td>
      <td style="text-align:left;">
        <img class="player-pic" src="${pic}" alt="${p}" />
        &nbsp;${p}
      </td>
      <td>${s.avg}</td>
      <td>${s.games}</td>
      <td>${s.wins}</td>
      <td>${s.losses}</td>
      <td>${s.winPercent}%</td>
      <td>${s.losePercent}%</td>
    </tr>`;
  }).join("");
}

function refresh() {
  loadStats();
  renderStats();
}

window.addEventListener("load", () => {
  refresh();
  setInterval(refresh, 5000); // Refresh every 5 seconds
});
</script>

</body>
</html>

