<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Darts Join & Stats</title>
  <style>
    body {
      background: #0a0a0a;
      color: #ffcc00;
      font-family: 'Arial Black', Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }

    #logoContainer img {
      max-width: 300px;
      margin-top: 50px;
    }

    input, button {
      padding: 10px;
      font-size: 1.2rem;
      margin-top: 10px;
    }

    #cameraContainer, #previewContainer {
      margin-top: 15px;
    }

    video, canvas {
      width: 300px;
      height: 225px;
      border: 3px solid #ffcc00;
      border-radius: 8px;
    }

    #statsSection {
      margin-top: 30px;
    }

    .statBox {
      background: #222200cc;
      border: 2px solid #ffcc00;
      padding: 20px;
      margin: 10px auto;
      border-radius: 12px;
      max-width: 400px;
    }

    #noGame {
      margin-top: 50px;
      font-size: 1.5rem;
      color: #888;
    }
  </style>
</head>
<body>

  <h1>Darts Join & Stats</h1>

  <div id="joinSection">
    <input type="text" id="playerName" placeholder="Enter your name" /><br />
    <button onclick="startCamera()">Take Picture</button>
    <div id="cameraContainer" style="display: none;">
      <video id="video" autoplay></video><br />
      <button onclick="capture()">Capture</button>
    </div>
    <div id="previewContainer" style="display: none;">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <div id="noGame" style="display: none;">
    <div id="logoContainer">
      <img src="assets/Logo.png" alt="Logo" />
    </div>
    <div>NO GAME ACTIVE</div>
  </div>

  <div id="statsSection" style="display: none;">
    <h2>Player Stats</h2>
    <div class="statBox" id="statOutput"></div>
  </div>

  <script>
    const joinKey = "darts_joined";
    const gameKey = "darts_game";
    let currentPlayer = null;
    let joined = false;

    function startCamera() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          document.getElementById("video").srcObject = stream;
          document.getElementById("cameraContainer").style.display = "block";
        });
    }

    function capture() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) {
        alert("Please enter your name.");
        return;
      }

      const canvas = document.getElementById("canvas");
      const video = document.getElementById("video");
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const dataURL = canvas.toDataURL("image/png");
      const players = JSON.parse(localStorage.getItem(joinKey) || "[]");

      if (!players.some(p => p.name === name)) {
        players.push({ name, image: dataURL });
        localStorage.setItem(joinKey, JSON.stringify(players));
        joined = true;
        currentPlayer = name;
        document.getElementById("joinSection").style.display = "none";
        document.getElementById("statsSection").style.display = "block";
      }
    }

    function updateStats() {
      const raw = localStorage.getItem(gameKey);
      if (!raw) {
        document.getElementById("noGame").style.display = "block";
        document.getElementById("statsSection").style.display = "none";
        return;
      }

      const game = JSON.parse(raw);

      if (!game.active) {
        document.getElementById("noGame").style.display = "block";
        document.getElementById("statsSection").style.display = "none";
        return;
      }

      if (joined && game.scores[currentPlayer]) {
        document.getElementById("noGame").style.display = "none";
        document.getElementById("statsSection").style.display = "block";
        const stats = game.scores[currentPlayer];
        const output = `
          <strong>${currentPlayer}</strong><br/>
          Total Score: ${stats.total}<br/>
          Average: ${stats.average}<br/>
          Shots Thrown: ${stats.shots}<br/>
          Remaining: ${stats.score}
        `;
        document.getElementById("statOutput").innerHTML = output;
      }
    }

    setInterval(updateStats, 1000);
    updateStats();
  </script>
</body>
</html>
