<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Darts Scoreboard</title>
  <style>
    body { background: radial-gradient(circle at center, #0a0a0a 0%, #121212 90%); color: #ffcc00; font-family: 'Arial Black', Arial, sans-serif; margin: 0; padding: 30px; user-select: none; }
    h1 { text-align: center; font-size: 3rem; margin-bottom: 10px; text-shadow: 0 0 8px #ffcc00; }
    #matchInfo { text-align: center; font-size: 1.5rem; margin-bottom: 20px; letter-spacing: 1px; }
    #scoreTable { margin: 0 auto; width: 400px; border-collapse: collapse; }
    #scoreTable th, #scoreTable td { border: 2px solid #ffcc00; padding: 15px 10px; font-size: 1.4rem; text-align: center; }
    #scoreTable th { background: #333300; }
    #scoreTable td.playerName { font-weight: bold; text-align: left; padding-left: 20px; }
    #popup { position: fixed; top: 15%; left: 50%; transform: translate(-50%, -50%); background: #222200; border: 3px solid #ffcc00; color: #fff; font-size: 2rem; padding: 20px 40px; border-radius: 10px; box-shadow: 0 0 15px #ffcc00; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 1000; }
    #finalResults { max-width: 500px; margin: 40px auto 0; background: #222200cc; border: 2px solid #ffcc00; border-radius: 12px; padding: 20px; }
    #finalResults h2 { text-align: center; margin-bottom: 15px; }
    #finalResults ol { font-size: 1.3rem; padding-left: 20px; }
    #logoOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:2000; transition: opacity 0.5s; }
    #logoOverlay img { max-width:80%; max-height:80%; opacity:0; transition: opacity 1s; }
  </style>
</head>
<body>
  <h1>Darts Scoreboard</h1>
  <div id="matchInfo">Waiting for game to start...</div>
  <table id="scoreTable" hidden>
    <thead><tr><th>Player</th><th>Score</th><th>Average</th></tr></thead>
    <tbody id="scoreBody"></tbody>
  </table>
  <div id="finalResults" hidden>
    <h2>Tournament Results</h2>
    <ol id="finalList"></ol>
  </div>
  <div id="popup"></div>
  <div id="logoOverlay"><img id="logoImg" src="assets/logo.png" /></div>

  <script>
    const matchInfo = document.getElementById('matchInfo');
    const scoreTable = document.getElementById('scoreTable');
    const scoreBody = document.getElementById('scoreBody');
    const popup = document.getElementById('popup');
    const finalResults = document.getElementById('finalResults');
    const finalList = document.getElementById('finalList');
    const logoOverlay = document.getElementById('logoOverlay');
    const logoImg = document.getElementById('logoImg');

    let lastPopupTs = 0;

    function renderScores(data) {
      const { players, scores, currentTurnIndex } = data;
      if (!players || players.length === 0) {
        matchInfo.textContent = 'Waiting for game to start...';
        scoreTable.hidden = true;
        return;
      }
      matchInfo.textContent = `Match: ${players.join(' vs ')} â€” Current: ${players[currentTurnIndex]}`;
      scoreBody.innerHTML = players.map(p => {
        const s = scores[p];
        return `<tr><td class="playerName">${p}</td><td>${s.score}</td><td>${s.average || 0}</td></tr>`;
      }).join('');
      scoreTable.hidden = false;
      finalResults.hidden = true;
    }

    function showPopup(msg) {
      popup.textContent = msg;
      popup.style.opacity = 1; popup.style.pointerEvents = 'auto';
      setTimeout(() => { popup.style.opacity = 0; popup.style.pointerEvents = 'none'; }, 2000);
    }

    function renderFinal(placements) {
      matchInfo.textContent = 'Tournament Complete!';
      scoreTable.hidden = true;
      finalResults.hidden = false;
      finalList.innerHTML = placements.map((p,i) => `<li><strong>Place ${i+1}:</strong> ${p}</li>`).join('');
    }

    function checkPopup() {
      const d = localStorage.getItem('darts_popup');
      if (!d) return;
      const { message, ts } = JSON.parse(d);
      if (ts > lastPopupTs) {
        lastPopupTs = ts;
        showPopup(message);
      }
    }

    function update() {
      const g = localStorage.getItem('darts_game');
      if (g) {
        renderScores(JSON.parse(g));
      } else {
        const f = localStorage.getItem('darts_final_results');
        if (f) {
          renderFinal(JSON.parse(f));
        }
      }
      checkPopup();
    }

    setInterval(update, 500);
    update();

    // Logo overlay logic
    function checkLogo() {
      const d = localStorage.getItem('darts_logo');
      if (!d) return;
      const { show } = JSON.parse(d);
      if (show) {
        logoOverlay.style.display = 'flex';
        setTimeout(() => { logoImg.style.opacity = 1; }, 50);
      } else {
        logoImg.style.opacity = 0;
        setTimeout(() => { logoOverlay.style.display = 'none'; }, 500);
      }
    }
    window.addEventListener('storage', checkLogo);
    checkLogo();
  </script>
</body>
</html>


