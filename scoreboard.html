
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Darts Scoreboard</title>
  <style>
    body {
      background: #111;
      color: #ffcc00;
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      text-align: center;
    }
    h1, h2 {
      color: #ffcc00;
    }
    #dartboard {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border-radius: 50%;
      position: relative;
      background: radial-gradient(circle at center, #222 50%, #111 100%);
      box-shadow: 0 0 20px #ffcc00;
    }
    #dartboard svg {
      width: 100%;
      height: 100%;
      pointer-events: none;
      user-select: none;
    }
    .dart {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #ffcc00;
      border-radius: 50%;
      border: 2px solid #000;
      box-shadow: 0 0 8px #ffcc00;
      transform: translate(-50%, -50%);
      animation: dart-fall 0.5s ease forwards;
      pointer-events: none;
    }
    @keyframes dart-fall {
      from {
        transform: translate(-50%, -150%) scale(0);
        opacity: 0;
      }
      to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }
    #scoreboard {
      margin-top: 20px;
      background: #222;
      padding: 10px;
      border-radius: 10px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      color: #ffcc00;
    }
    th, td {
      border: 1px solid #ffcc00;
      padding: 6px 10px;
    }
    #popup {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 204, 0, 0.9);
      color: #111;
      font-weight: bold;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 1.4rem;
      box-shadow: 0 0 10px #ffcc00;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    #matchStatus {
      margin-top: 10px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #ffcc00;
      text-shadow: 0 0 6px #ffcc00;
    }
  </style>
</head>
<body>

  <h1>Darts Scoreboard</h1>
  <div id="dartboard">
    <svg viewBox="0 0 200 200" aria-label="Dartboard" role="img" >
      <circle cx="100" cy="100" r="100" fill="#222"/>
      <circle cx="100" cy="100" r="90" stroke="#fff" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="60" stroke="#0f0" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="40" stroke="#f00" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="10" fill="#ff0000"/>
      <circle cx="100" cy="100" r="5" fill="#00ff00"/>
    </svg>
  </div>

  <div id="matchStatus">Waiting for game...</div>

  <div id="scoreboard">
    <table>
      <thead>
        <tr><th>Player</th><th>Score</th><th>Last Score</th></tr>
      </thead>
      <tbody id="scoreTableBody"></tbody>
    </table>
  </div>

  <div id="popup"></div>

  <script>
    const dartboard = document.getElementById('dartboard');
    const scoreTableBody = document.getElementById('scoreTableBody');
    const popup = document.getElementById('popup');
    const matchStatus = document.getElementById('matchStatus');

    let lastPopupTimestamp = 0;

    function showPopup(message) {
      popup.textContent = message;
      popup.style.opacity = '1';
      lastPopupTimestamp = Date.now();
      setTimeout(() => {
        if (Date.now() - lastPopupTimestamp >= 2000) {
          popup.style.opacity = '0';
        }
      }, 2000);
    }

    function placeDart(score, throwIndex) {
      // Map score to approximate dartboard coordinates:
      // Center (100,100)
      // Just simulate random small variations around circles for simplicity
      let cx = 100;
      let cy = 100;
      if (score === 50) {
        // bullseye center
        cx = 100;
        cy = 100;
      } else if (score === 25) {
        // outer bull
        cx = 100 + (Math.random() * 30 - 15);
        cy = 100 + (Math.random() * 30 - 15);
      } else if (score >= 20) {
        // inner rings
        cx = 100 + (Math.random() * 40 - 20);
        cy = 100 + (Math.random() * 40 - 20);
      } else if (score >= 10) {
        cx = 100 + (Math.random() * 60 - 30);
        cy = 100 + (Math.random() * 60 - 30);
      } else {
        cx = 100 + (Math.random() * 80 - 40);
        cy = 100 + (Math.random() * 80 - 40);
      }

      const dart = document.createElement('div');
      dart.className = 'dart';
      dart.style.left = `${cx}px`;
      dart.style.top = `${cy}px`;
      dart.style.animationDelay = `${throwIndex * 0.6}s`;
      dartboard.appendChild(dart);

      setTimeout(() => {
        dart.remove();
      }, 4000);
    }

    function updateScores(data) {
      if (!data || !data.scores) return;

      const scores = data.scores;
      const players = Object.keys(scores);

      scoreTableBody.innerHTML = '';
      players.forEach(player => {
        const row = document.createElement('tr');
        const pCell = document.createElement('td');
        const sCell = document.createElement('td');
        const lCell = document.createElement('td');
        pCell.textContent = player;
        sCell.textContent = scores[player].score;
        lCell.textContent = scores[player].last || 0;
        row.appendChild(pCell);
        row.appendChild(sCell);
        row.appendChild(lCell);
        scoreTableBody.appendChild(row);
      });

      if (data.throws && data.throws.length > 0) {
        data.throws.forEach((score, idx) => placeDart(score, idx));
        showPopup(`${data.match[data.currentPlayer]} scored ${data.throws.reduce((a,b) => a + b, 0)}`);
      }

      if (data.winners && data.winners.length > 0) {
        showPopup(`Winner: ${data.winners[data.winners.length-1]}`);
      }

      if (data.match) {
        matchStatus.textContent = `Match: ${data.match[0]} vs ${data.match[1]} - Turn: ${data.match[data.currentPlayer]}`;
      }
    }

    function poll() {
      const stored = localStorage.getItem('darts_game');
      if (stored) {
        try {
          const data = JSON.parse(stored);
          updateScores(data);
        } catch(e) {}
      }

      // Check popup sync
      const popupDataRaw = localStorage.getItem('darts_popup');
      if (popupDataRaw) {
        try {
          const popupData = JSON.parse(popupDataRaw);
          if (popupData.timestamp > lastPopupTimestamp) {
            showPopup(popupData.message);
            lastPopupTimestamp = popupData.timestamp;
          }
        } catch(e) {}
      }

      setTimeout(poll, 1000);
    }

    poll();
  </script>
</body>
</html>


