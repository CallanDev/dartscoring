<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Darts Scoreboard</title>
<style>
body {
  background-color: #000;
  color: #fff;
  font-family: 'Arial', sans-serif;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 {
  font-size: 3rem;
  color: #ffcc00;
  margin-bottom: 20px;
}
.player-list {
  display: flex;
  justify-content: center;
  gap: 30px;
  flex-wrap: wrap;
}
.player {
  border: 3px solid #ffcc00;
  padding: 15px;
  border-radius: 15px;
  width: 200px;
  background: #222;
  position: relative;
}
.player-photo {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #ffcc00;
  margin-bottom: 10px;
}
.player-name {
  font-weight: bold;
  font-size: 1.3rem;
}
.player-score {
  font-size: 2rem;
  margin-top: 5px;
  color: #fff;
}
#freezeOverlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: black;
  color: #ffcc00;
  font-size: 5rem;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  user-select: none;
  flex-direction: column;
  font-weight: 900;
}
#freezeOverlay .dart { color: red; }
#freezeOverlay .score { font-style: italic; }
</style>
</head>
<body>
<h1>Darts Scoreboard</h1>

<div id="playersContainer" class="player-list"></div>

<div id="freezeOverlay"><div><span class="dart">dart</span><span class="score">Score</span></div></div>

<script>
let players = [];
let gameMode = 501;
let isTournament = false;
let tournamentMatches = [];
let currentMatchIndex = 0;
let matchScores = {};
let scores = {};
let freezeActive = false;

function renderPlayers() {
  const container = document.getElementById("playersContainer");
  container.innerHTML = "";
  const playerData = isTournament && tournamentMatches.length > 0 ?
    tournamentMatches[currentMatchIndex] :
    players.map(p => p.name);

  // Build display players list
  let displayPlayers = [];
  if (isTournament && tournamentMatches.length > 0) {
    const match = tournamentMatches[currentMatchIndex];
    displayPlayers = players.filter(p => match.includes(p.name));
  } else {
    displayPlayers = players;
  }

  for (const p of displayPlayers) {
    let remaining = isTournament ? (matchScores[p.name] ?? gameMode) : (scores[p.name] ?? gameMode);
    container.innerHTML += `
      <div class="player">
        <img src="${p.photo}" alt="${p.name}" class="player-photo" />
        <div class="player-name">${p.name}</div>
        <div class="player-score">${remaining}</div>
      </div>
    `;
  }
}

function loadState() {
  const stateStr = localStorage.getItem("dartGameState");
  if (!stateStr) return;
  const state = JSON.parse(stateStr);
  players = state.players || [];
  gameMode = state.gameMode || 501;
  isTournament = state.isTournament || false;
  tournamentMatches = state.tournamentMatches || [];
  currentMatchIndex = state.currentMatchIndex || 0;
  matchScores = state.matchScores || {};
  scores = state.scores || {};
  freezeActive = state.freezeActive || false;

  renderPlayers();
  toggleFreezeOverlay(freezeActive);
}

function toggleFreezeOverlay(active) {
  const overlay = document.getElementById("freezeOverlay");
  if (active) {
    overlay.style.display = "flex";
  } else {
    overlay.style.display = "none";
  }
}

// Listen for storage changes to keep in sync
window.addEventListener("storage", (e) => {
  if (e.key === "dartGameState" || e.key === "freezeToggle") {
    loadState();
  }
});

// Initial load and periodic refresh every 2s for safety
loadState();
setInterval(loadState, 2000);
</script>
</body>
</html>
