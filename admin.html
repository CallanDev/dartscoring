
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Darts Admin</title>
  <style>
    body {
      background: #111;
      color: #ffcc00;
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    h1, h2 {
      color: #ffcc00;
    }
    input, button, select {
      padding: 6px;
      font-size: 1rem;
      margin: 5px 0;
    }
    .section {
      margin-top: 20px;
    }
    #dartboard {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      display: block;
      border-radius: 50%;
      cursor: crosshair;
    }
    .log {
      background: #222;
      padding: 10px;
      margin-top: 20px;
      height: 120px;
      overflow-y: auto;
    }
    #breakScreen {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      color: #fff;
      font-size: 2.5rem;
      text-align: center;
      justify-content: center;
      align-items: center;
      z-index: 999;
      flex-direction: column;
    }
  </style>
</head>
<body>

  <h1>Darts Admin Panel</h1>

  <div id="setup">
    <h2>Setup</h2>
    <label>Game Mode:
      <select id="gameMode">
        <option value="301">301</option>
        <option value="501" selected>501</option>
        <option value="701">701</option>
      </select>
    </label>
    <br>
    <label>Tournament Mode:
      <input type="checkbox" id="tournamentMode" />
    </label>
    <br>
    <label>Full Tournament (round-robin):
      <input type="checkbox" id="fullTournament" />
    </label>
    <br>
    <input type="text" id="playerName" placeholder="Enter player name" />
    <button onclick="addPlayer()">Add Player</button>
    <ul id="playerList"></ul>
    <button onclick="startTournament()">Start Tournament</button>
  </div>

  <div id="gameArea" style="display:none;">
    <h2 id="matchTitle">Match</h2>
    <svg id="dartboard" viewBox="0 0 200 200" onclick="throwDart(event)">
      <circle cx="100" cy="100" r="100" fill="#222"/>
      <circle cx="100" cy="100" r="90" stroke="#fff" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="60" stroke="#0f0" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="40" stroke="#f00" stroke-width="1" fill="none"/>
      <circle cx="100" cy="100" r="10" fill="#ff0000"/>
      <circle cx="100" cy="100" r="5" fill="#00ff00"/>
    </svg>
    <p>Click dartboard to throw (3 throws per turn)</p>
    <p id="turnDisplay"></p>
  </div>

  <div class="log" id="log"></div>

  <div id="breakScreen">
    <div>Break Time</div>
    <div id="breakTimer">3:00</div>
  </div>

  <script>
    let players = [];
    let matches = [];
    let scores = {};
    let throws = [];
    let gameMode = 501;
    let matchIndex = 0;
    let playerIndex = 0;
    let winners = [];
    let losers = [];

    function addPlayer() {
      const name = document.getElementById('playerName').value.trim();
      if (name) {
        players.push(name);
        document.getElementById('playerList').innerHTML = players.map(p => `<li>${p}</li>`).join('');
        document.getElementById('playerName').value = '';
      }
    }

    function startTournament() {
      gameMode = parseInt(document.getElementById("gameMode").value);
      const full = document.getElementById("fullTournament").checked;

      matches = [];
      if (full) {
        for (let i = 0; i < players.length; i++) {
          for (let j = i + 1; j < players.length; j++) {
            matches.push([players[i], players[j]]);
          }
        }
      } else {
        for (let i = 0; i < players.length - 1; i += 2) {
          matches.push([players[i], players[i + 1]]);
        }
      }

      matchIndex = 0;
      startMatch();
    }

    function startMatch() {
      if (matchIndex >= matches.length) {
        log("Tournament Finished");
        localStorage.setItem("darts_final_results", JSON.stringify(winners.concat(losers)));
        return;
      }

      throws = [];
      playerIndex = 0;
      const match = matches[matchIndex];
      scores = {
        [match[0]]: { score: gameMode, history: [], last: 0 },
        [match[1]]: { score: gameMode, history: [], last: 0 }
      };

      document.getElementById('setup').style.display = 'none';
      document.getElementById('gameArea').style.display = 'block';
      updateUI();
      syncGame();
    }

    function throwDart(event) {
      const rect = event.target.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const dx = x - 100;
      const dy = y - 100;
      const dist = Math.sqrt(dx * dx + dy * dy);

      let score = 0;
      if (dist < 5) score = 50;
      else if (dist < 10) score = 25;
      else if (dist < 40) score = 20;
      else if (dist < 60) score = 10;
      else if (dist < 90) score = 5;
      else score = 1;

      throws.push(score);
      log(`${getCurrentPlayer()} scored ${score}`);

      if (throws.length === 3) {
        finishTurn();
      }
    }

    function finishTurn() {
      const player = getCurrentPlayer();
      const total = throws.reduce((a, b) => a + b, 0);
      scores[player].score -= total;
      scores[player].last = total;
      scores[player].history.push(total);
      showPopup(`${player} scored ${total}`);
      log(`${player} now has ${scores[player].score}`);

      if (scores[player].score <= 0) {
        const opponent = getOpponent();
        winners.push(player);
        losers.push(opponent);
        showPopup(`${player} WINS!`);
        matchIndex++;
        startBreak();
        return;
      }

      playerIndex = (playerIndex + 1) % 2;
      throws = [];
      updateUI();
      syncGame();
    }

    function getCurrentPlayer() {
      return matches[matchIndex][playerIndex];
    }

    function getOpponent() {
      return matches[matchIndex][(playerIndex + 1) % 2];
    }

    function updateUI() {
      const match = matches[matchIndex];
      document.getElementById("matchTitle").textContent = `Match: ${match[0]} vs ${match[1]}`;
      document.getElementById("turnDisplay").textContent = `Turn: ${getCurrentPlayer()}`;
    }

    function syncGame() {
      localStorage.setItem("darts_game", JSON.stringify({
        match: matches[matchIndex],
        scores,
        currentPlayer: playerIndex,
        winners,
        losers,
        throws
      }));
    }

    function showPopup(message) {
      localStorage.setItem("darts_popup", JSON.stringify({ message, timestamp: Date.now() }));
    }

    function log(message) {
      const el = document.getElementById("log");
      const div = document.createElement("div");
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      el.prepend(div);
    }

    function startBreak() {
      const screen = document.getElementById("breakScreen");
      const timer = document.getElementById("breakTimer");
      let seconds = 180;
      screen.style.display = 'flex';
      const interval = setInterval(() => {
        seconds--;
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        timer.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
        if (seconds <= 0) {
          clearInterval(interval);
          screen.style.display = 'none';
          startMatch();
        }
      }, 1000);
    }
  </script>
</body>
</html>


