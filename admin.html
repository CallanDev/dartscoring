<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
    h1, h2 { color: #ffcc00; }
    label, select, input, button { display: block; margin: 10px 0; font-size: 1rem; }
    #logoToggle { padding: 10px; border: none; cursor: pointer; }
    #logoToggle.on { background: green; }
    #logoToggle.off { background: red; }
    #throwSection { display: none; margin-top: 20px; }
    #log { background: #222; padding: 10px; max-height: 200px; overflow-y: auto; }
    #bracket { margin-top: 20px; }
    .match { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Game Controls -->
  <h2>Game Setup</h2>
  <label>Game Type:
    <select id="gameType">
      <option value="practice">Practice</option>
      <option value="301">301</option>
      <option value="501">501</option>
      <option value="701">701</option>
      <option value="lastman">Last Man Standing</option>
      <option value="ballsmash">Ball Smash</option>
    </select>
  </label>
  <button onclick="openJoining()">Open Joining</button>
  <button onclick="startGame()">Start Game</button>
  <button onclick="endGame()">End Game</button>
  <button id="logoToggle" class="off" onclick="toggleLogo()">Logo OFF</button>

  <!-- Throw Input Section -->
  <div id="throwSection">
    <h2>Enter Throws</h2>
    <div id="currentPlayer"></div>
    <label>Throw 1: <input type="number" id="t1" min="0" max="180" /></label>
    <label>Throw 2: <input type="number" id="t2" min="0" max="180" /></label>
    <label>Throw 3: <input type="number" id="t3" min="0" max="180" /></label>
    <button onclick="submitThrows()">Submit</button>
    <div id="bracket"></div>
  </div>

  <h2>Log</h2>
  <div id="log"></div>

<script>
// Core game data
let game = { active: false, type: "", players: [], scores: {}, turn: 0, allowJoin: false };

// Persist to localStorage
function sync() { localStorage.setItem('darts_game', JSON.stringify(game)); }

// Log utility
function log(msg) {
  const el = document.getElementById('log');
  el.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${msg}</div>`;
  el.scrollTop = el.scrollHeight;
}

// Open joining
function openJoining() {
  game.allowJoin = true;
  game.active = false;
  game.players = [];
  game.scores = {};
  sync();
  log('Joining opened.');
}

// Start game
function startGame() {
  const joined = JSON.parse(localStorage.getItem('darts_joined')||'[]');
  if (!joined.length) return alert('No players joined.');
  game.type = document.getElementById('gameType').value;
  game.active = true;
  game.allowJoin = false;
  game.players = [...joined];
  game.scores = {};
  game.players.forEach(p => game.scores[p.name] = { score:  (['301','501','701'].includes(game.type)? parseInt(game.type):0), throws: 0, total: 0 });
  game.turn = 0;
  sync();
  document.getElementById('throwSection').style.display = 'block';
  updateCurrentPlayer();
  log('Game started.');
}

// End game
function endGame() {
  game.active = false;
  game.allowJoin = false;
  sync();
  document.getElementById('throwSection').style.display = 'none';
  log('Game ended.');
}

// Toggle logo
function toggleLogo() {
  const btn = document.getElementById('logoToggle');
  const on = btn.classList.toggle('on');
  btn.classList.toggle('off', !on);
  btn.innerText = on ? 'Logo ON' : 'Logo OFF';
  localStorage.setItem('darts_logo', on ? 'on':'off');
}

// Update current player UI
function updateCurrentPlayer() {
  const cp = game.players[game.turn];
  document.getElementById('currentPlayer').innerText = `Current: ${cp.name}`;
}

// Submit throws
function submitThrows() {
  const t1 = +document.getElementById('t1').value || 0;
  const t2 = +document.getElementById('t2').value || 0;
  const t3 = +document.getElementById('t3').value || 0;
  const total = t1 + t2 + t3;
  const name = game.players[game.turn];
  const sc = game.scores[name];
  if (['301','501','701'].includes(game.type)) {
    if (sc.score - total >= 0) sc.score -= total;
  } else {
    sc.total += total;
  }
  sc.throws++;
  log(`${name} threw ${total}. Remaining: ${sc.score}`);
  game.turn = (game.turn + 1) % game.players.length;
  sync();
  updateCurrentPlayer();
}

// Listen cross-tab join updates
window.addEventListener('storage', e => {
  if (e.key === 'darts_joined') sync();
});

// Initial load
if (localStorage.getItem('darts_logo') === 'on') {
  document.getElementById('logoToggle').classList.add('on');
  document.getElementById('logoToggle').innerText = 'Logo ON';
}
sync();
</script>
</body>
</html>
